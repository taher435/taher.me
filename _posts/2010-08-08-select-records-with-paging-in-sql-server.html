---
layout: post
title: Select records with paging in SQL server
date: 2010-08-08 23:33:00.000000000 +08:00
type: post
published: true
status: publish
categories:
- SQL Server
tags: []
meta:
  blogger_blog: tdtechdiary.blogspot.com
  blogger_author: Taher Dhilawala
  blogger_d55bd4009d1dee1a46eef7a078bee8f9_permalink: '169322956593652397'
  _edit_last: '14307922'
  _wpas_skip_fb: '1'
author:
  login: tdtechdiary
  email: salaam_taher@yahoo.com
  display_name: Taher Dhilawala
  first_name: ''
  last_name: ''
---
<p>In enterprise web applications, there is often a requirement to present a list of items. In ASP.net it is generally achieved by implementing a Grid View or a Repeater control. But in an application dealing with huge data it is required to have a paging method. This is generally done by the front end. I came across a very good way to do paging in SQL query only. Let’s look at it with the help of an example,</p>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:green;font-family:&quot;font-size:10pt;">/* CREATE DUMMY TABLE */</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">CREATE</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">TABLE</span> tbl_paging<span style="color:grey;">(</span>id <span style="color:blue;">int</span><span style="color:grey;">,</span> name <span style="color:blue;">varchar</span><span style="color:grey;">(</span>100<span style="color:grey;">))</span></span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:green;font-family:&quot;font-size:10pt;">/* INSERT SOME VALUES */</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">INSERT</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">INTO</span> tbl_paging</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">SELECT</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="font-family:&quot;font-size:10pt;">      <span style="color:magenta;">ROW_NUMBER</span><span style="color:grey;">()</span> <span style="color:blue;">over </span><span style="color:grey;">(</span><span style="color:blue;">partition</span> <span style="color:blue;">by</span> 1 <span style="color:blue;">order</span> <span style="color:blue;">by</span> <span style="color:magenta;">object_id</span><span style="color:grey;">),</span></span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="font-family:&quot;font-size:10pt;">      <span style="color:blue;">CASE</span> </span></div>
<div class="MsoNormal" style="line-height:normal;margin:0 0 .0001pt 1in;"><span style="color:blue;font-family:&quot;font-size:10pt;">WHEN</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:magenta;">ROW_NUMBER</span><span style="color:grey;">()</span> <span style="color:blue;">over </span><span style="color:grey;">(</span><span style="color:blue;">partition</span> <span style="color:blue;">by</span> 1 <span style="color:blue;">order</span> <span style="color:blue;">by</span> <span style="color:magenta;">object_id</span><span style="color:grey;">)</span> <span style="color:grey;">%</span> 2<span style="color:grey;">=</span>0 <span style="color:blue;">THEN</span> <span style="color:red;">'EVEN'</span>       </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="font-family:&quot;font-size:10pt;">            <span style="color:blue;">ELSE</span> <span style="color:red;">'ODD'</span></span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="font-family:&quot;font-size:10pt;">      <span style="color:blue;">END</span></span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">FROM</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:green;">sys</span><span style="color:grey;">.</span><span style="color:green;">objects</span></span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:green;font-family:&quot;font-size:10pt;">/* CHECK THE VALUES IN THE TABLE */</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">SELECT</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:grey;">*</span> <span style="color:blue;">FROM</span> tbl_paging</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;"><br />
</span></div>
<div class="separator" style="clear:both;text-align:center;"><a style="clear:left;float:left;margin-bottom:1em;margin-right:1em;" href="http://tdtechdiary.files.wordpress.com/2010/08/11.png"><img src="{{ site.baseurl }}/assets/11.png?w=300" alt="" border="0" /></a></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;"><br />
</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:green;font-family:&quot;font-size:10pt;">/* SELECT RECORDS BASED ON 2 INDICATORS, CURRENT PAGE AND PAGE SIZE (number of records to be displayed in one page) */</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">DECLARE</span><span style="font-family:&quot;font-size:10pt;"> @currentPage <span style="color:blue;">int</span><span style="color:grey;">,</span> @pageSize <span style="color:blue;">int</span></span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">SET</span><span style="font-family:&quot;font-size:10pt;"> @currentPage<span style="color:grey;">=</span>1 <span style="color:green;">--</span></span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">SET</span><span style="font-family:&quot;font-size:10pt;"> @pageSize<span style="color:grey;">=</span>15 <span style="color:green;">-- We will display 15 records per page</span></span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">SELECT</span><span style="font-family:&quot;font-size:10pt;"> id<span style="color:grey;">,</span>name <span style="color:blue;">FROM</span> </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:grey;font-family:&quot;font-size:10pt;">(</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="font-family:&quot;font-size:10pt;">      <span style="color:blue;">SELECT</span> <span style="color:magenta;">ROW_NUMBER</span><span style="color:grey;">()</span> <span style="color:blue;">OVER </span><span style="color:grey;">(</span><span style="color:blue;">PARTITION</span> <span style="color:blue;">BY</span> 1 <span style="color:blue;">ORDER</span> <span style="color:blue;">BY</span> id<span style="color:grey;">)</span> <span style="color:blue;">as</span> [UID]<span style="color:grey;">,</span>id<span style="color:grey;">,</span>name <span style="color:blue;">FROM</span> tbl_paging</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:grey;font-family:&quot;font-size:10pt;">)</span><span style="font-family:&quot;font-size:10pt;"> X</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">WHERE</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">UID</span> <span style="color:grey;">BETWEEN</span><span style="color:grey;">((</span>@currentPage<span style="color:grey;">-</span>1<span style="color:grey;">)</span> <span style="color:grey;">*</span> @pageSize<span style="color:grey;">)</span> <span style="color:grey;">+</span> 1 <span style="color:grey;">AND</span><span style="color:grey;">(</span>@currentPage <span style="color:grey;">*</span> @pageSize<span style="color:grey;">)</span></span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;"><br />
</span></div>
<div class="separator" style="clear:both;text-align:center;"><a style="clear:left;float:left;margin-bottom:1em;margin-right:1em;" href="http://tdtechdiary.files.wordpress.com/2010/08/21.png"><img src="{{ site.baseurl }}/assets/21.png?w=300" alt="" border="0" /></a></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;"><br />
</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:green;font-family:&quot;font-size:10pt;">/* CLEAN UP CODE */</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">DROP</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">TABLE</span> tbl_paging</span></div>
<div class="MsoNormal" style="text-align:justify;"><span style="color:blue;font-family:&quot;font-size:10pt;line-height:115%;">GO</span></div>
