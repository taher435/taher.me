---
layout: post
title: Some SQL Trips & Tricks learned at GIDS 2010 (Great Indian Developer Summit)
date: 2010-05-08 22:26:00.000000000 +08:00
type: post
published: true
status: publish
categories:
- SQL Server
tags: []
meta:
  blogger_blog: tdtechdiary.blogspot.com
  blogger_author: Taher Dhilawala
  blogger_d55bd4009d1dee1a46eef7a078bee8f9_permalink: '4505385397980668815'
  _edit_last: '14307922'
  _wpas_skip_fb: '1'
author:
  login: tdtechdiary
  email: salaam_taher@yahoo.com
  display_name: Taher Dhilawala
  first_name: ''
  last_name: ''
---
<p>T-SQL 2008, Tips and Tricks</p>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;">SQL Server 2008 provides many features which were not there in its predecessor 2005.</div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;">We will directly dive into the examples showing some tips and tricks for SQL server 2008.</div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><strong>Example 1:</strong></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">DECLARE</span><span style="font-family:&quot;font-size:10pt;"> @str <span style="color:blue;">VARCHAR</span><span style="color:grey;">=</span><span style="color:red;">'1234567890'</span> </span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><span style="color:blue;font-family:&quot;font-size:10pt;line-height:115%;">SELECT</span><span style="font-family:&quot;font-size:10pt;line-height:115%;"> <span style="color:magenta;">DATALENGTH</span><span style="color:grey;">(</span>@str<span style="color:grey;">)</span> [Length]<span style="color:grey;">,</span>@str [Value]</span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"> <strong>OUTPUT</strong></div>
<div class="separator" style="clear:both;text-align:justify;"><a style="font-family:courier new;margin-left:1em;margin-right:1em;" href="http://tdtechdiary.files.wordpress.com/2010/05/1.jpg"><img src="{{ site.baseurl }}/assets/1.jpg?w=240" alt="" border="0" /></a></div>
<div style="text-align:justify;"><span style="font-family:times new roman;"> </span></div>
<div style="text-align:justify;"><!--  /* Font Definitions */  @font-face 	{font-family:"Cambria Math"; 	panose-1:2 4 5 3 5 4 6 3 2 4; 	mso-font-charset:0; 	mso-generic-font-family:roman; 	mso-font-pitch:variable; 	mso-font-signature:-1610611985 1107304683 0 0 159 0;} @font-face 	{font-family:Calibri; 	panose-1:2 15 5 2 2 2 4 3 2 4; 	mso-font-charset:0; 	mso-generic-font-family:swiss; 	mso-font-pitch:variable; 	mso-font-signature:-1610611985 1073750139 0 0 159 0;}  /* Style Definitions */  p.MsoNormal, li.MsoNormal, div.MsoNormal 	{mso-style-unhide:no; 	mso-style-qformat:yes; 	mso-style-parent:""; 	margin-top:0in; 	margin-right:0in; 	margin-bottom:10.0pt; 	margin-left:0in; 	line-height:115%; 	mso-pagination:widow-orphan; 	font-size:11.0pt; 	font-family:"Calibri","sans-serif"; 	mso-fareast-font-family:"Times New Roman"; 	mso-bidi-font-family:"Times New Roman";} .MsoChpDefault 	{mso-style-type:export-only; 	mso-default-props:yes; 	font-size:10.0pt; 	mso-ansi-font-size:10.0pt; 	mso-bidi-font-size:10.0pt; 	mso-ascii-font-family:Calibri; 	mso-hansi-font-family:Calibri;} @page Section1 	{size:8.5in 11.0in; 	margin:1.0in 1.0in 1.0in 1.0in; 	mso-header-margin:.5in; 	mso-footer-margin:.5in; 	mso-paper-source:0;} div.Section1 	{page:Section1;} --><br />
<strong></strong> <span style="font-family:times new roman;"> </span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;">We get only the first character because if we don’t specify a length for a varchar SQL Server by default takes 1 character <strong> </strong></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><strong>Example 2:</strong> First let us create all the objects which are required for this example,</div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">CREATE</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">TABLE</span> tbl_dummy<span style="color:grey;">(</span>id <span style="color:blue;">int</span> <span style="color:blue;">identity</span><span style="color:grey;">(</span>1<span style="color:grey;">,</span>1<span style="color:grey;">),</span>name <span style="color:blue;">varchar</span><span style="color:grey;">(</span>10<span style="color:grey;">))</span>  </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span><span style="font-family:&quot;font-size:10pt;">  </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">INSERT</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">INTO</span> tbl_dummy <span style="color:blue;">VALUES</span><span style="color:grey;">(</span><span style="color:red;">'one'</span><span style="color:grey;">),(</span><span style="color:red;">'two'</span><span style="color:grey;">),(</span><span style="color:red;">'three'</span><span style="color:grey;">),(</span><span style="color:red;">'four'</span><span style="color:grey;">)</span>  </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">CREATE</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">TABLE</span> tbl_dummy_2<span style="color:grey;">(</span>id <span style="color:blue;">int</span> <span style="color:blue;">identity</span><span style="color:grey;">(</span>100<span style="color:grey;">,</span>5<span style="color:grey;">),</span>name <span style="color:blue;">varchar</span><span style="color:grey;">(</span>30<span style="color:grey;">))</span> </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">INSERT</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">INTO</span> tbl_dummy_2 <span style="color:blue;">VALUES</span><span style="color:grey;">(</span><span style="color:red;">'Hundred'</span><span style="color:grey;">),(</span><span style="color:red;">'Hundred Five'</span><span style="color:grey;">),(</span><span style="color:red;">'Hundred Ten'</span><span style="color:grey;">),(</span><span style="color:red;">'Hundred Fifteen'</span><span style="color:grey;">)</span> <span style="color:blue;">GO</span> </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">CREATE</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">TRIGGER</span> trg_tbl_dummy <span style="color:blue;">ON</span> tbl_dummy </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">FOR</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">INSERT</span>  </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">AS</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">INSERT</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">INTO</span> tbl_dummy_2 <span style="color:blue;">VALUES</span><span style="color:grey;">(</span><span style="color:red;">'TRIGGER'</span><span style="color:grey;">)</span> </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;">We created two tables with an identity column. We also created a trigger on INSERT of one table and inserting into another table. Now, we want to check when we fire an insert on the first table what value we get for the IDENTITY column. So we execute the below commands,</div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">INSERT</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">INTO</span> tbl_dummy <span style="color:blue;">VALUES</span><span style="color:grey;">(</span><span style="color:red;">'SIX'</span><span style="color:grey;">)</span>  </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">SELECT</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:magenta;">@@IDENTITY</span> <span style="color:green;">-- OUTPUT = 120 ;Gives the Last identity value (tbl_dummy_2)  </span></span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><span style="color:blue;font-family:&quot;font-size:10pt;line-height:115%;">GO</span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><span style="color:blue;font-family:&quot;font-size:10pt;line-height:115%;">SELECT</span><span style="font-family:&quot;font-size:10pt;line-height:115%;"> <span style="color:magenta;">SCOPE_IDENTITY</span><span style="color:grey;">()</span> <span style="color:green;">-- OUPUT = 5 ; Gives the IDENTITY Value of the table on which insert was executed (current session)</span></span></div>
<div style="text-align:justify;"><a style="font-family:courier new;" href="http://tdtechdiary.files.wordpress.com/2010/05/2.jpg"><img src="{{ site.baseurl }}/assets/2.jpg?w=227" alt="" border="0" /></a> <span style="font-family:times new roman;"> </span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;">The explanation is clear in the output.</div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;">Now writing the cleanup code,</div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">DROP</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">TRIGGER</span> trg_tbl_dummy </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">DROP</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">TABLE</span> tbl_dummy </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span><span style="font-family:&quot;font-size:10pt;">  </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">DROP</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">TABLE</span> tbl_dummy_2  </span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><strong>Example 3: </strong>How to order a separated string value.</div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;">Suppose that we have a column in a table which contains IP address. How do we sort them? Because IP address will be stored as string. We will run the below query and check the output,</div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">CREATE</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">TABLE</span> tbl_dummy<span style="color:grey;">(</span>id <span style="color:blue;">int</span> <span style="color:grey;">,</span>ip_add <span style="color:blue;">varchar</span><span style="color:grey;">(</span>50<span style="color:grey;">))</span> </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">INSERT</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:blue;">INTO</span> tbl_dummy <span style="color:blue;">VALUES</span><span style="color:grey;">(</span>1<span style="color:grey;">,</span><span style="color:red;">'192.168.1.10'</span><span style="color:grey;">),(</span>2<span style="color:grey;">,</span><span style="color:red;">'3.1.250.190'</span><span style="color:grey;">),(</span>3<span style="color:grey;">,</span><span style="color:red;">'169.128.2.23'</span><span style="color:grey;">)</span>  </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span><span style="font-family:&quot;font-size:10pt;">  </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">SELECT</span><span style="font-family:&quot;font-size:10pt;"> ip_add <span style="color:blue;">FROM</span> tbl_dummy <span style="color:blue;">order</span> <span style="color:blue;">by</span> ip_add </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span><span style="font-family:&quot;font-size:10pt;">  </span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><span style="color:blue;font-family:&quot;font-size:10pt;line-height:115%;">SELECT</span><span style="font-family:&quot;font-size:10pt;line-height:115%;"> ip_add <span style="color:blue;">FROM</span> tbl_dummy <span style="color:blue;">order</span> <span style="color:blue;">by</span> <span style="color:magenta;">CAST</span><span style="color:grey;">(</span><span style="color:red;">'/'</span><span style="color:grey;">+</span>ip_add<span style="color:grey;">+</span><span style="color:red;">'/'</span> <span style="color:blue;">AS</span> <span style="color:blue;">HIERARCHYID</span><span style="color:grey;">)</span></span></div>
<p><span style="font-family:times new roman;"> </span></p>
<div style="text-align:justify;"><a style="clear:left;float:left;font-family:courier new;margin-bottom:1em;margin-right:1em;" href="http://tdtechdiary.files.wordpress.com/2010/05/3.jpg"><img src="{{ site.baseurl }}/assets/3.jpg?w=200" alt="" border="0" /></a></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;">Without hierarchyid we would have to write a complex logic to separate the string and then sort the separated parts and then merge them again.</div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"> Clean up code,</div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><span style="color:blue;font-family:&quot;font-size:10pt;line-height:115%;">DROP</span><span style="font-family:&quot;font-size:10pt;line-height:115%;"> <span style="color:blue;">TABLE</span> tbl_dummy</span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><strong>Example 4:</strong></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;">Suppose that you have a datetime column and you need to compare that with another date, say, from the front end. Generally what we do is we convert both the dates and make the time as 00:00:00 so that the time factor does not come into picture. See the below queries,</div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">SELECT</span><span style="font-family:&quot;font-size:10pt;"> <span style="color:magenta;">CAST</span><span style="color:grey;">(</span><span style="color:magenta;">CONVERT</span><span style="color:grey;">(</span><span style="color:blue;">varchar</span><span style="color:grey;">(</span>10<span style="color:grey;">),</span><span style="color:magenta;">GETDATE</span><span style="color:grey;">(),</span>112<span style="color:grey;">)</span> <span style="color:blue;">AS</span> <span style="color:blue;">DATETIME</span><span style="color:grey;">)</span> </span></div>
<div class="MsoNormal" style="line-height:normal;margin-bottom:.0001pt;"><span style="color:blue;font-family:&quot;font-size:10pt;">GO</span></div>
<div class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;"><span style="color:blue;font-family:&quot;font-size:10pt;line-height:115%;">SELECT</span><span style="font-family:&quot;font-size:10pt;line-height:115%;"> <span style="color:magenta;">DATEADD</span><span style="color:grey;">(</span>d<span style="color:grey;">,</span><span style="color:magenta;">DATEDIFF</span><span style="color:grey;">(</span>d<span style="color:grey;">,</span>0<span style="color:grey;">,</span><span style="color:magenta;">GETDATE</span><span style="color:grey;">()),</span>0<span style="color:grey;">)</span></span></div>
<p><span style="font-family:times new roman;"> </span><span style="font-family:times new roman;"> </span></p>
<div style="text-align:justify;"><img src="{{ site.baseurl }}/assets/4.jpg?w=178" alt="" border="0" /> <span style="font-family:times new roman;"> </span></div>
<div style="text-align:justify;">
<p><span style="font-family:&quot;font-size:11pt;line-height:115%;">The output of the both the query is same. But the drawback of the first one is that it converts a datetime value to a text and then a text to again datetime, which is costly. In the second one we just play around with datetime and there is no datatype conversion. The logic used in the second query is that, we are using a base date (1/1/1900) for our comparison and then subtracting it, so it will always remove the time factor. </span></p>
</div>
<div class="blogger-post-footer"></div>
